# api_server_image_compression


### **Описание сервиса: api_server_image_compression**

#### **Цель**  
Сервис предназначен для **асинхронной обработки загружаемых файлов** (например, изображений, документов) с гарантированной доставкой задач и отслеживанием статусов.  

#### **Ключевые функции**  
1. **Приём файлов** через REST API (FastAPI):  
   - Проверка размера файла (`MAX_FILE_SIZE`).  
   - Сохранение в локальную папку (`UPLOAD_DIR`).  
2. **Фиксация метаданных** в PostgreSQL:  
   - ID файла (UUID), оригинальное имя, путь, статус (`uploaded`).  
3. **Постановка задач в RabbitMQ**:  
   - Отправка пути к файлу в очередь (`QUEUE_NAME`).  
   - Настройка Dead Letter Queue (`DLQ_NAME`) для обработки ошибок.  
4. **Масштабируемость**:  
   - Worker’ы (отдельный процесс `ссылка на сервис с Worker`) могут обрабатывать задачи параллельно.  

#### **Технологии**  
- **Python 3.11** + FastAPI (HTTP-сервер).  
- **PostgreSQL** — хранение метаданных файлов.  
- **RabbitMQ** — очередь задач с отказоустойчивостью (DLQ).  
- **Podman/Docker** — контейнеризация.  

#### **Сценарии использования**  
1. **Загрузка изображений** с последующей компрессией.  
2. **Конвертация документов** (можно добавить уже у `ссылка на сервис с Worker`).  
3. **Очередь задач** для ресурсоёмких операций.  

#### **Пример запроса**  
```bash
curl -X POST -F "file=@photo.jpg" http://localhost:8000/upload/
```
**Ответ**:  
```json
{
  "message": "File uploaded and sent for processing",
  "file_id": "a1b2c3d4-..."
}
```

#### **Преимущества**  
- **Асинхронность** — HTTP-сервер не блокируется на обработке.  
- **Надёжность** — DLQ и повторы при ошибках.  
- **Простота** — минимальные зависимости, конфигурация через `.env`.  

Для завершения системы требуется **Worker** (см. `ссылка на сервис с Worker`), который будет забирать задачи из RabbitMQ и обрабатывать файлы.